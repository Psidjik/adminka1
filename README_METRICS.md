# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –º–µ—Ç—Ä–∏–∫ –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. –î–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏ Prometheus –≤–æ –≤—Å–µ —Ç—Ä–∏ –ø—Ä–æ–µ–∫—Ç–∞

**API-Gateway:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `prometheus-net.AspNetCore` –≤–µ—Ä—Å–∏–∏ 8.2.1
- –ù–∞—Å—Ç—Ä–æ–µ–Ω endpoint `/metrics` –Ω–∞ –ø–æ—Ä—Ç—É 8080
- –î–æ–±–∞–≤–ª–µ–Ω—ã middleware –¥–ª—è —Å–±–æ—Ä–∞ HTTP –º–µ—Ç—Ä–∏–∫

**CabinetBooking:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `prometheus-net.AspNetCore` –≤–µ—Ä—Å–∏–∏ 8.2.1
- –ù–∞—Å—Ç—Ä–æ–µ–Ω endpoint `/metrics` –Ω–∞ –ø–æ—Ä—Ç—É 28710
- –î–æ–±–∞–≤–ª–µ–Ω—ã middleware –¥–ª—è —Å–±–æ—Ä–∞ HTTP –º–µ—Ç—Ä–∏–∫

**User:**
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `prometheus-net.AspNetCore` –≤–µ—Ä—Å–∏–∏ 8.2.1
- –ù–∞—Å—Ç—Ä–æ–µ–Ω endpoint `/metrics` –Ω–∞ –ø–æ—Ä—Ç—É 28711
- –î–æ–±–∞–≤–ª–µ–Ω—ã middleware –¥–ª—è —Å–±–æ—Ä–∞ HTTP –º–µ—Ç—Ä–∏–∫

### 2. –û–±–Ω–æ–≤–ª–µ–Ω docker-compose.yml

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –ø—É—Ç–∏ –∫ –ø—Ä–æ–µ–∫—Ç–∞–º (—Ç–µ–ø–µ—Ä—å –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ: `./CabinetBooking`, `./API-Gateway`, `./User`)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î —á–µ—Ä–µ–∑ –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω –ø–æ—Ä—Ç –¥–ª—è User —Å–µ—Ä–≤–∏—Å–∞ (28711 –≤–º–µ—Å—Ç–æ 28730)
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏ (depends_on)

**–î–æ–±–∞–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã:**
- ‚úÖ **Prometheus** –Ω–∞ –ø–æ—Ä—Ç—É 9090
- ‚úÖ **Grafana** –Ω–∞ –ø–æ—Ä—Ç—É 3000 (–ª–æ–≥–∏–Ω: admin, –ø–∞—Ä–æ–ª—å: admin)

### 3. –°–æ–∑–¥–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus

–§–∞–π–ª `prometheus/prometheus.yml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ —Å–±–æ—Ä –º–µ—Ç—Ä–∏–∫:
- api-gateway:8080/metrics
- cabinet-booking:28710/metrics
- user:28711/metrics

### 4. –°–æ–∑–¥–∞–Ω–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Grafana

- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø—Ä–æ–≤–∞–π–¥–∏–Ω–≥ Prometheus –∫–∞–∫ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- –ë–∞–∑–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –º–µ—Ç—Ä–∏–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

### 5. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∞–¥—Ä–µ—Å–∞ gRPC –≤ API-Gateway

–¢–µ–ø–µ—Ä—å API-Gateway –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –∏–º–µ–Ω–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞–º:
- `http://cabinet-booking:28710` –≤–º–µ—Å—Ç–æ `http://localhost:28710`
- `http://user:28711` –≤–º–µ—Å—Ç–æ `http://localhost:28711`

### 6. –°–æ–∑–¥–∞–Ω Jenkinsfile

–°–æ–∑–¥–∞–Ω —Ñ–∞–π–ª `Jenkinsfile` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ —Å–±–æ—Ä–∫–∏ –∏ –¥–µ–ø–ª–æ—è —á–µ—Ä–µ–∑ Jenkins.

## üìã –ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–¥–∞–Ω–∏—è

### –®–∞–≥ 1: –ó–∞–∫–∏–Ω—É—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Git

```bash
# –ï—Å–ª–∏ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –µ—â–µ –Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω
git init
git add .
git commit -m "Add Prometheus metrics and monitoring setup"

# –î–æ–±–∞–≤–∏—Ç—å remote —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git remote add origin <URL_–í–ê–®–ï–ì–û_–†–ï–ü–û–ó–ò–¢–û–†–ò–Ø>
git push -u origin main
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Jenkins

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Jenkins** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):
   ```bash
   docker run -d -p 8080:8080 -p 50000:50000 \
     -v jenkins_home:/var/jenkins_home \
     --name jenkins \
     jenkins/jenkins:lts
   ```

2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–ª–∞–≥–∏–Ω—ã**:
   - Docker Pipeline
   - Git
   - Docker Compose Build Step

3. **–°–æ–∑–¥–∞—Ç—å Pipeline Job**:
   - New Item -> Pipeline
   - –í —Ä–∞–∑–¥–µ–ª–µ Pipeline –≤—ã–±—Ä–∞—Ç—å "Pipeline script from SCM"
   - –£–∫–∞–∑–∞—Ç—å URL –≤–∞—à–µ–≥–æ Git —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
   - –£–∫–∞–∑–∞—Ç—å –ø—É—Ç—å –∫ Jenkinsfile: `Jenkinsfile`

4. **–ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–±–æ—Ä–∫—É**:
   - –í –Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö Pipeline –≤–∫–ª—é—á–∏—Ç—å "Build Triggers" -> "GitHub hook trigger for GITScm polling"
   - –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å Poll SCM –¥–ª—è –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π

### –®–∞–≥ 3: –ü–æ–¥–Ω—è—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ docker-compose

```bash
# –°–æ–∑–¥–∞—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL (–ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ)
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É postgres –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç—å:
docker exec -it booking-db psql -U postgres
CREATE DATABASE cabinet_booking;
CREATE DATABASE users;
\q

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# –ü—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose logs -f
```

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏

1. **Prometheus**: http://localhost:9090
   - –ü–µ—Ä–µ–π—Ç–∏ –≤ Status -> Targets
   - –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –≤—Å–µ targets –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ UP
   - –í —Ä–∞–∑–¥–µ–ª–µ Graph –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä: `rate(http_requests_received_total[5m])`

2. **Grafana**: http://localhost:3000
   - –õ–æ–≥–∏–Ω: `admin`, –ø–∞—Ä–æ–ª—å: `admin`
   - –ü–µ—Ä–µ–π—Ç–∏ –≤ Dashboards -> Browse
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –¥–∞—à–±–æ—Ä–¥—ã –∑–∞–≥—Ä—É–∂–µ–Ω—ã

### –®–∞–≥ 5: –ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å CI/CD

1. **–°–¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ** (–Ω–∞–ø—Ä–∏–º–µ—Ä, –∏–∑–º–µ–Ω–∏—Ç—å –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π)
2. **–ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å**:
   ```bash
   git add .
   git commit -m "Test changes for CI/CD demo"
   git push
   ```
3. **–ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ Jenkins –∑–∞–ø—É—Å—Ç–∏–ª —Å–±–æ—Ä–∫—É**:
   - –û—Ç–∫—Ä—ã—Ç—å Jenkins UI
   - –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å–±–æ—Ä–∫–∞ –∑–∞–ø—É—Å—Ç–∏–ª–∞—Å—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
   - –ü–æ–∫–∞–∑–∞—Ç—å –ª–æ–≥–∏ —Å–±–æ—Ä–∫–∏
   - –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–∏–ª–∏—Å—å

## üéØ –ü–ª–∞–Ω –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏ –Ω–∞ –∑–∞—á–µ—Ç–µ

1. **–ü–æ–∫–∞–∑–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ –∏ docker-compose.yml**
   ```bash
   cat docker-compose.yml
   ```

2. **–ü–æ–¥–Ω—è—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã**
   ```bash
   docker-compose up -d
   docker-compose ps
   ```

3. **–ü–æ–∫–∞–∑–∞—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –≤ Prometheus**
   - –û—Ç–∫—Ä—ã—Ç—å http://localhost:9090
   - –ü–æ–∫–∞–∑–∞—Ç—å targets (–≤—Å–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å UP)
   - –í—ã–ø–æ–ª–Ω–∏—Ç—å –∑–∞–ø—Ä–æ—Å –º–µ—Ç—Ä–∏–∫

4. **–ü–æ–∫–∞–∑–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã –≤ Grafana**
   - –û—Ç–∫—Ä—ã—Ç—å http://localhost:3000
   - –ü–æ–∫–∞–∑–∞—Ç—å –¥–∞—à–±–æ—Ä–¥—ã —Å –º–µ—Ç—Ä–∏–∫–∞–º–∏

5. **–ü—Ä–æ–¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å CI/CD**
   - –ü–æ–∫–∞–∑–∞—Ç—å Jenkins
   - –°–¥–µ–ª–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –∫–æ–¥–µ
   - –ó–∞–∫–æ–º–º–∏—Ç–∏—Ç—å –∏ –∑–∞–ø—É—à–∏—Ç—å
   - –ü–æ–∫–∞–∑–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é —Å–±–æ—Ä–∫—É –≤ Jenkins
   - –ü–æ–∫–∞–∑–∞—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –æ–±–Ω–æ–≤–∏–ª–∏—Å—å

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã –º–µ—Ç—Ä–∏–∫

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å endpoint –º–µ—Ç—Ä–∏–∫ –∫–∞–∂–¥–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞:

```bash
# API-Gateway
curl http://localhost:8080/metrics

# CabinetBooking
curl http://localhost:28710/metrics

# User
curl http://localhost:28711/metrics
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ Prometheus —Å–æ–±–∏—Ä–∞–µ—Ç –º–µ—Ç—Ä–∏–∫–∏:

1. –û—Ç–∫—Ä—ã—Ç—å http://localhost:9090
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ Status -> Targets
3. –í—Å–µ —Ç—Ä–∏ —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ UP

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—É—Å–∫–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –≤ PostgreSQL
2. **–ü–æ—Ä—Ç—ã**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ—Ä—Ç—ã 8080, 28710, 28711, 9090, 3000, 5443 –Ω–µ –∑–∞–Ω—è—Ç—ã
3. **Docker**: –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ Docker –∏ Docker Compose —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∏ –∑–∞–ø—É—â–µ–Ω—ã
4. **Jenkins**: –î–ª—è —Ä–∞–±–æ—Ç—ã Jenkins —Å Docker –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
CabinetBooking/
‚îú‚îÄ‚îÄ API-Gateway/
‚îÇ   ‚îî‚îÄ‚îÄ src/Gateway.Api/
‚îÇ       ‚îú‚îÄ‚îÄ Program.cs (–¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏)
‚îÇ       ‚îî‚îÄ‚îÄ Gateway.Api.csproj (–¥–æ–±–∞–≤–ª–µ–Ω –ø–∞–∫–µ—Ç prometheus-net.AspNetCore)
‚îú‚îÄ‚îÄ CabinetBooking/
‚îÇ   ‚îî‚îÄ‚îÄ src/CabinetBooking.Api/
‚îÇ       ‚îú‚îÄ‚îÄ Program.cs (–¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏)
‚îÇ       ‚îî‚îÄ‚îÄ CabinetBooking.Api.csproj (–¥–æ–±–∞–≤–ª–µ–Ω –ø–∞–∫–µ—Ç prometheus-net.AspNetCore)
‚îú‚îÄ‚îÄ User/
‚îÇ   ‚îî‚îÄ‚îÄ src/User.Api/
‚îÇ       ‚îú‚îÄ‚îÄ Program.cs (–¥–æ–±–∞–≤–ª–µ–Ω—ã –º–µ—Ç—Ä–∏–∫–∏)
‚îÇ       ‚îî‚îÄ‚îÄ User.Api.csproj (–¥–æ–±–∞–≤–ª–µ–Ω –ø–∞–∫–µ—Ç prometheus-net.AspNetCore)
‚îú‚îÄ‚îÄ docker-compose.yml (–æ–±–Ω–æ–≤–ª–µ–Ω: –¥–æ–±–∞–≤–ª–µ–Ω—ã Prometheus –∏ Grafana)
‚îú‚îÄ‚îÄ prometheus/
‚îÇ   ‚îî‚îÄ‚îÄ prometheus.yml (–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Prometheus)
‚îú‚îÄ‚îÄ grafana/
‚îÇ   ‚îî‚îÄ‚îÄ provisioning/
‚îÇ       ‚îú‚îÄ‚îÄ datasources/prometheus.yml
‚îÇ       ‚îî‚îÄ‚îÄ dashboards/
‚îÇ           ‚îú‚îÄ‚îÄ dashboard.yml
‚îÇ           ‚îî‚îÄ‚îÄ application-metrics.json
‚îú‚îÄ‚îÄ Jenkinsfile (—Å–æ–∑–¥–∞–Ω –¥–ª—è CI/CD)
‚îî‚îÄ‚îÄ DEPLOYMENT.md (–ø–æ–¥—Ä–æ–±–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è)
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
# 1. –°–æ–∑–¥–∞—Ç—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker exec -it booking-db psql -U postgres -c "CREATE DATABASE cabinet_booking;"
docker exec -it booking-db psql -U postgres -c "CREATE DATABASE users;"

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
docker-compose up -d

# 3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose ps

# 4. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ:
# - Prometheus: http://localhost:9090
# - Grafana: http://localhost:3000 (admin/admin)
# - API Gateway: http://localhost:8080/graphql/ui
```

